@model AutoGestao.Models.FormFieldViewModel

@{
    var fieldId = Model.PropertyName;
    var fieldValue = Model.Value?.ToString() ?? "0";
    var referenceType = Model.Reference?.Name ?? "";
    var isReadOnly = Model.ReadOnly;
    var isRequired = Model.Required || Model.IsConditionallyRequired;
    var filterConfig = Model.ReferenceFilters ?? "{}";
}

<div class="reference-field-container position-relative reference-search-wrapper">
    <input type="hidden" name="@fieldId" value="@fieldValue" id="@(fieldId)_value" />

    <div class="input-group">
        <input type="text"
            class="form-control reference-search-input"
            id="@(fieldId)_search"
            placeholder="@(isReadOnly ? "" : string.IsNullOrEmpty(Model.Placeholder) ? "Digite para pesquisar..." : Model.Placeholder)"
            autocomplete="off"
            data-reference-type="@referenceType"
            data-target-field="@fieldId"
            data-reference-filters='@Html.Raw(filterConfig)'
            readonly="@isReadOnly"
            @(isRequired ? "required" : "") />

        @if (!isReadOnly)
        {
            <button type="button"
                    class="btn btn-success reference-create-btn"
                    id="@(fieldId)_create"
                    title="Criar novo registro"
                    data-reference-type="@referenceType"
                    data-target-field="@fieldId">
                <i class="fas fa-plus"></i>
            </button>

            <button type="button"
                    class="btn btn-outline-secondary reference-clear-btn"
                    id="@(fieldId)_clear"
                    title="Limpar seleção"
                    onclick="clearReferenceField('@fieldId')">
                <i class="fas fa-times"></i>
            </button>
        }
    </div>

    <div class="reference-dropdown" id="@(fieldId)_dropdown" style="display: none;"></div>
</div>

<style>
    .reference-field-container {
        position: relative;
    }

        .reference-field-container .selected {
            background-color: #e7f3ff;
            border-color: #007bff;
        }

    .reference-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 4px 4px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .reference-item {
        padding: 10px 12px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
    }

        .reference-item:hover,
        .reference-item.active {
            background-color: #f5f5f5;
        }

    .reference-create-btn {
        border-radius: 0;
    }

    .reference-clear-btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
</style>