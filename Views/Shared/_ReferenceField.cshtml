@model AutoGestao.Models.FormFieldViewModel

@{
    var fieldId = Model.PropertyName;
    var fieldValue = Model.Value?.ToString() ?? "0";
    var displayText = Model.DisplayText ?? "";
    var hasValue = !string.IsNullOrEmpty(displayText) && fieldValue != "0";
    var referenceType = Model.Reference?.Name ?? "";
    var isReadOnly = Model.ReadOnly;
    var isRequired = Model.Required || Model.IsConditionallyRequired;
    var filterConfig = Model.ReferenceFilters ?? "{}";
}

<div class="reference-field-container position-relative reference-search-wrapper">
    @* CAMPO HIDDEN - ESTE É O CAMPO QUE SERÁ ENVIADO NO FORM *@
    <input type="hidden"
           name="@fieldId"
           id="@(fieldId)_value"
           value="@fieldValue"
           data-original-value="@fieldValue" />

    <div class="input-group">
        <input type="text"
               class="form-control reference-search-input @(hasValue ? "selected" : "")"
               id="@(fieldId)_search"
               value="@displayText"
               placeholder="@(isReadOnly ? "" : string.IsNullOrEmpty(Model.Placeholder) ? "Digite para pesquisar..." : Model.Placeholder)"
               autocomplete="off"
               data-reference-type="@referenceType"
               data-target-field="@fieldId"
               data-reference-filters='@Html.Raw(filterConfig)'
               readonly="@isReadOnly"
               @(isRequired ? "required" : "") />

        @if (!isReadOnly)
        {
            <button type="button"
                    class="btn btn-primary reference-search-btn"
                    id="@(fieldId)_search_all"
                    title="Buscar registros existentes"
                    data-reference-type="@referenceType"
                    data-target-field="@fieldId">
                <i class="fas fa-search"></i>
            </button>

            <button type="button"
                    class="btn btn-success reference-create-btn"
                    id="@(fieldId)_create"
                    title="Criar novo registro"
                    data-reference-type="@referenceType"
                    data-target-field="@fieldId">
                <i class="fas fa-plus"></i>
            </button>

            <button type="button"
                    class="btn btn-outline-secondary reference-clear-btn"
                    id="@(fieldId)_clear"
                    title="Limpar seleção">
                <i class="fas fa-times"></i>
            </button>
        }
    </div>

    <div class="reference-dropdown" id="@(fieldId)_dropdown" style="display: none;"></div>
</div>