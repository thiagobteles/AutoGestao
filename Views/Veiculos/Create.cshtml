@using AutoGestao.Entidades
@using AutoGestao.Entidades.Veiculos
@model Veiculo
@{
    ViewData["Title"] = "Novo Ve√≠culo";
}

<div class="dashboard-container fade-in">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="page-title">
                <i class="fas fa-plus-circle"></i>
                Novo Ve√≠culo
            </h1>
            <p class="page-subtitle mb-0">Cadastre um novo ve√≠culo no sistema</p>
        </div>
        <div>
            <a asp-action="Index" class="btn-modern btn-outline-modern">
                <i class="fas fa-arrow-left"></i>
                Voltar √† Lista
            </a>
        </div>
    </div>

    <form asp-action="Create" method="post" class="slide-in-right">
        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

        <div class="grid-2 mb-4">
            <!-- Card: Informa√ß√µes B√°sicas -->
            <div class="card-modern">
                <div class="card-header-modern">
                    <i class="fas fa-info-circle"></i>
                    Informa√ß√µes B√°sicas
                </div>
                <div class="card-body-modern">
                    <div class="form-group-modern">
                        <label asp-for="Codigo" class="form-label-modern">
                            <i class="fas fa-barcode me-1"></i>C√≥digo *
                        </label>
                        <input asp-for="Codigo" class="form-control-modern" placeholder="Digite o c√≥digo √∫nico do ve√≠culo" required />
                        <span asp-validation-for="Codigo" class="text-danger"></span>
                    </div>

                    <div class="form-group-modern">
                        <label asp-for="Placa" class="form-label-modern">
                            <i class="fas fa-id-card me-1"></i>Placa *
                        </label>
                        <input asp-for="Placa" class="form-control-modern" placeholder="XXX-0000 ou XXX0X00" required />
                        <span asp-validation-for="Placa" class="text-danger"></span>
                    </div>

                    <div class="grid-2">
                        <div class="form-group-modern">
                            <label asp-for="Marca" class="form-label-modern">
                                <i class="fas fa-tag me-1"></i>Marca *
                            </label>
                            <input asp-for="Marca" class="form-control-modern" placeholder="Ex: Volkswagen, Ford" required />
                            <span asp-validation-for="Marca" class="text-danger"></span>
                        </div>
                        <div class="form-group-modern">
                            <label asp-for="Modelo" class="form-label-modern">
                                <i class="fas fa-car me-1"></i>Modelo *
                            </label>
                            <input asp-for="Modelo" class="form-control-modern" placeholder="Ex: Gol, Fiesta" required />
                            <span asp-validation-for="Modelo" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="grid-3">
                        <div class="form-group-modern">
                            <label asp-for="AnoFabricacao" class="form-label-modern">
                                <i class="fas fa-calendar me-1"></i>Ano Fabrica√ß√£o *
                            </label>
                            <input asp-for="AnoFabricacao" class="form-control-modern" type="number" min="1900" max="2030" required />
                            <span asp-validation-for="AnoFabricacao" class="text-danger"></span>
                        </div>
                        <div class="form-group-modern">
                            <label asp-for="AnoModelo" class="form-label-modern">
                                <i class="fas fa-calendar-alt me-1"></i>Ano Modelo *
                            </label>
                            <input asp-for="AnoModelo" class="form-control-modern" type="number" min="1900" max="2030" required />
                            <span asp-validation-for="AnoModelo" class="text-danger"></span>
                        </div>
                        <div class="form-group-modern">
                            <label asp-for="Quilometragem" class="form-label-modern">
                                <i class="fas fa-road me-1"></i>Quilometragem
                            </label>
                            <input asp-for="Quilometragem" class="form-control-modern" type="number" placeholder="Ex: 50000" />
                            <span asp-validation-for="Quilometragem" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card: Caracter√≠sticas -->
            <div class="card-modern">
                <div class="card-header-modern">
                    <i class="fas fa-cog"></i>
                    Caracter√≠sticas
                </div>
                <div class="card-body-modern">
                    <div class="grid-2">
                        <div class="form-group-modern">
                            <label asp-for="Cor" class="form-label-modern">
                                <i class="fas fa-palette me-1"></i>Cor
                            </label>
                            <select asp-for="Cor" class="form-select-modern">
                                <option value="">Selecione a cor...</option>
                                <option value="Branco">Branco</option>
                                <option value="Preto">Preto</option>
                                <option value="Prata">Prata</option>
                                <option value="Cinza">Cinza</option>
                                <option value="Vermelho">Vermelho</option>
                                <option value="Azul">Azul</option>
                                <option value="Verde">Verde</option>
                                <option value="Amarelo">Amarelo</option>
                                <option value="Bege">Bege</option>
                                <option value="Marrom">Marrom</option>
                            </select>
                            <span asp-validation-for="Cor" class="text-danger"></span>
                        </div>
                        <div class="form-group-modern">
                            <label asp-for="Combustivel" class="form-label-modern">
                                <i class="fas fa-gas-pump me-1"></i>Combust√≠vel
                            </label>
                            <select asp-for="Combustivel" class="form-select-modern">
                                <option value="">Selecione o combust√≠vel...</option>
                                <option value="Gasolina">‚õΩ Gasolina</option>
                                <option value="Etanol">üå± Etanol</option>
                                <option value="Flex">üîÑ Flex</option>
                                <option value="Diesel">üöõ Diesel</option>
                                <option value="GNV">üí® GNV</option>
                                <option value="El√©trico">üîã El√©trico</option>
                                <option value="H√≠brido">‚ö° H√≠brido</option>
                            </select>
                            <span asp-validation-for="Combustivel" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="form-group-modern">
                            <label asp-for="Cambio" class="form-label-modern">
                                <i class="fas fa-gear me-1"></i>C√¢mbio
                            </label>
                            <select asp-for="Cambio" class="form-select-modern">
                                <option value="">Selecione o c√¢mbio...</option>
                                <option value="Manual">üéõÔ∏è Manual</option>
                                <option value="Autom√°tico">‚öôÔ∏è Autom√°tico</option>
                                <option value="CVT">üîÑ CVT</option>
                                <option value="Automatizado">ü§ñ Automatizado</option>
                            </select>
                        </div>
                        <div class="form-group-modern">
                            <label asp-for="Motorizacao" class="form-label-modern">
                                <i class="fas fa-engine me-1"></i>Motoriza√ß√£o
                            </label>
                            <input asp-for="Motorizacao" class="form-control-modern" placeholder="Ex: 1.6, 1.0 turbo, 2.0" required maxlength="50"/>
                            <span asp-validation-for="Motorizacao" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-group-modern">
                        <label asp-for="Chassi" class="form-label-modern">
                            <i class="fas fa-fingerprint me-1"></i>Chassi
                        </label>
                        <input asp-for="Chassi" class="form-control-modern" placeholder="N√∫mero do chassi (17 d√≠gitos)" maxlength="17" />
                    </div>

                    <div class="form-group-modern">
                        <label asp-for="Renavam" class="form-label-modern">
                            <i class="fas fa-id-badge me-1"></i>RENAVAM
                        </label>
                        <input asp-for="Renavam" class="form-control-modern" placeholder="N√∫mero do RENAVAM" />
                    </div>
                </div>
            </div>
        </div>

        <div class="grid-2 mb-4">
            <!-- Card: Valores -->
            <div class="card-modern">
                <div class="card-header-modern">
                    <i class="fas fa-dollar-sign"></i>
                    Valores
                </div>
                <div class="card-body-modern">
                    <div class="form-group-modern">
                        <label asp-for="PrecoCompra" class="form-label-modern">
                            <i class="fas fa-shopping-cart me-1"></i>Pre√ßo de Compra
                        </label>
                        <input asp-for="PrecoCompra" class="form-control-modern" type="number" step="0.01" placeholder="0,00" />
                        <small class="text-muted">Valor pago na aquisi√ß√£o do ve√≠culo</small>
                        <span asp-validation-for="PrecoCompra" class="text-danger"></span>
                    </div>

                    <div class="form-group-modern">
                        <label asp-for="PrecoVenda" class="form-label-modern">
                            <i class="fas fa-money-bill-wave me-1"></i>Pre√ßo de Venda
                        </label>
                        <input asp-for="PrecoVenda" class="form-control-modern" type="number" step="0.01" placeholder="0,00" />
                        <small class="text-muted">Valor de venda pretendido</small>
                        <span asp-validation-for="PrecoVenda" class="text-danger"></span>
                    </div>

                    <div class="form-group-modern">
                        <label asp-for="ProprietarioId" class="form-label-modern">
                            <i class="fas fa-user me-1"></i>Propriet√°rio
                        </label>
                        <select asp-for="ProprietarioId" class="form-select-modern" asp-items="ViewBag.ProprietarioId">
                            <option value="">üë§ Selecione um propriet√°rio...</option>
                        </select>
                        <small class="text-muted">Cliente que possui o ve√≠culo</small>
                    </div>
                </div>
            </div>

            <!-- Card: Detalhes Adicionais -->
            <div class="card-modern">
                <div class="card-header-modern">
                    <i class="fas fa-clipboard-list"></i>
                    Detalhes Adicionais
                </div>
                <div class="card-body-modern">
                    <div class="form-group-modern">
                        <label asp-for="Situacao" class="form-label-modern">
                            <i class="fas fa-flag me-1"></i>Situa√ß√£o
                        </label>
                        <select asp-for="Situacao" class="form-select-modern">
                            <option value="1">üì¶ Estoque</option>
                            <option value="2">‚úÖ Vendido</option>
                            <option value="3">üîí Reservado</option>
                            <option value="4">üîß Manuten√ß√£o</option>
                        </select>
                    </div>

                    <div class="grid-2">
                        <div class="form-group-modern">
                            <label asp-for="TipoVeiculo" class="form-label-modern">
                                <i class="fas fa-car-side me-1"></i>Tipo
                            </label>
                            <select asp-for="TipoVeiculo" class="form-select-modern">
                                <option value="Consignado">ü§ù Consignado</option>
                                <option value="Pr√≥prio">üè¢ Pr√≥prio</option>
                                <option value="Terceiros">üë• Terceiros</option>
                            </select>
                        </div>
                        <div class="form-group-modern">
                            <label asp-for="StatusVeiculo" class="form-label-modern">
                                <i class="fas fa-star me-1"></i>Condi√ß√£o
                            </label>
                            <select asp-for="StatusVeiculo" class="form-select-modern">
                                <option value="Usado">üîÑ Usado</option>
                                <option value="Seminovo">‚ú® Seminovo</option>
                                <option value="Zero">üÜï Zero KM</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group-modern">
                        <label asp-for="Localizacao" class="form-label-modern">
                            <i class="fas fa-map-marker-alt me-1"></i>Localiza√ß√£o
                        </label>
                        <select asp-for="Localizacao" class="form-select-modern">
                            <option value="P√°tio">üÖøÔ∏è P√°tio</option>
                            <option value="Showroom">üè¢ Showroom</option>
                            <option value="Oficina">üîß Oficina</option>
                            <option value="Externa">üåç Externa</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card: Observa√ß√µes -->
        <div class="card-modern mb-4">
            <div class="card-header-modern">
                <i class="fas fa-sticky-note"></i>
                Observa√ß√µes e Opcionais
            </div>
            <div class="card-body-modern">
                <div class="grid-2">
                    <div class="form-group-modern">
                        <label asp-for="Opcionais" class="form-label-modern">
                            <i class="fas fa-plus-square me-1"></i>Opcionais
                        </label>
                        <textarea asp-for="Opcionais" class="form-control-modern" rows="4"
                                  placeholder="Ex: Ar condicionado, dire√ß√£o hidr√°ulica, vidros el√©tricos, travas el√©tricas..."></textarea>
                        <span asp-validation-for="Opcionais" class="text-danger"></span>
                    </div>

                    <div class="form-group-modern">
                        <label asp-for="Observacoes" class="form-label-modern">
                            <i class="fas fa-comment me-1"></i>Observa√ß√µes Gerais
                        </label>
                        <textarea asp-for="Observacoes" class="form-control-modern" rows="4"
                                  placeholder="Informa√ß√µes adicionais sobre o ve√≠culo, estado de conserva√ß√£o, etc..."></textarea>
                        <span asp-validation-for="Observacoes" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot√µes de A√ß√£o -->
        <div class="card-modern">
            <div class="card-body-modern">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="d-flex gap-3">
                        <button type="button" class="btn-modern btn-secondary-modern" onclick="limparFormulario()">
                            <i class="fas fa-eraser"></i>
                            Limpar
                        </button>
                        <a asp-action="Index" class="btn-modern btn-outline-modern">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </a>
                        <button type="submit" class="btn-modern btn-primary-modern">
                            <i class="fas fa-save"></i>
                            Salvar Ve√≠culo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Auto-completar ano modelo
        document.querySelector('input[name="AnoFabricacao"]').addEventListener('change', function() {
            const anoFab = parseInt(this.value);
            const anoModeloInput = document.querySelector('input[name="AnoModelo"]');
            if (anoFab && !anoModeloInput.value) {
                anoModeloInput.value = anoFab + 1;
            }
        });

        // Calcular margem de lucro
        function calcularMargem() {
            const compra = parseFloat(document.querySelector('input[name="PrecoCompra"]').value) || 0;
            const venda = parseFloat(document.querySelector('input[name="PrecoVenda"]').value) || 0;

            if (compra > 0 && venda > 0) {
                const margem = ((venda - compra) / compra * 100).toFixed(2);
                console.log(`Margem de lucro: ${margem}%`);
            }
        }

        document.querySelector('input[name="PrecoCompra"]').addEventListener('change', calcularMargem);
        document.querySelector('input[name="PrecoVenda"]').addEventListener('change', calcularMargem);

        // Limpar formul√°rio
        function limparFormulario() {
            if (confirm('Tem certeza que deseja limpar todos os campos?')) {
                document.querySelector('form').reset();
            }
        }

        // Formata√ß√£o da placa
        document.querySelector('input[name="Placa"]').addEventListener('input', function() {
            let value = this.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
            if (value.length <= 7) {
                if (value.length > 3) {
                    value = value.substring(0, 3) + '-' + value.substring(3);
                }
                this.value = value;
            }
        });
    </script>
}