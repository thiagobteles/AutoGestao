@using AutoGestao.Entidades
@model Cliente
@{
    ViewData["Title"] = "Novo Cliente";
}

<div class="dashboard-container fade-in">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="page-title">
                <i class="fas fa-user-plus"></i>
                Novo Cliente
            </h1>
            <p class="page-subtitle mb-0">Cadastre um novo cliente no sistema</p>
        </div>
        <div>
            <a asp-action="Index" class="btn-modern btn-outline-modern">
                <i class="fas fa-arrow-left"></i>
                Voltar √† Lista
            </a>
        </div>
    </div>

    <form asp-action="Create" method="post" class="slide-in-right">
        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

        <!-- Tipo de Cliente -->
        <div class="card-modern mb-4">
            <div class="card-header-modern">
                <i class="fas fa-user-tag"></i>
                Tipo de Cliente
            </div>
            <div class="card-body-modern">
                <div class="form-group-modern">
                    <label asp-for="TipoCliente" class="form-label-modern">
                        <i class="fas fa-users me-1"></i>Selecione o tipo *
                    </label>
                    <select asp-for="TipoCliente" class="form-select-modern" id="tipoCliente" required>
                        <option value="">Selecione o tipo de cliente...</option>
                        <option value="PessoaFisica">üë§ Pessoa F√≠sica</option>
                        <option value="PessoaJuridica">üè¢ Pessoa Jur√≠dica</option>
                    </select>
                    <span asp-validation-for="TipoCliente" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="grid-2 mb-4">
            <!-- Dados Pessoais/Empresariais -->
            <div class="card-modern">
                <div class="card-header-modern">
                    <i class="fas fa-id-card"></i>
                    <span id="dadosTitle">Dados B√°sicos</span>
                </div>
                <div class="card-body-modern">
                    <div class="form-group-modern">
                        <label asp-for="Nome" class="form-label-modern">
                            <i class="fas fa-signature me-1"></i><span id="nomeLabel">Nome *</span>
                        </label>
                        <input asp-for="Nome" class="form-control-modern" placeholder="Digite o nome completo" required />
                        <span asp-validation-for="Nome" class="text-danger"></span>
                    </div>

                    <!-- Campos Pessoa F√≠sica -->
                    <div id="camposPF" style="display: none;">
                        <div class="grid-2">
                            <div class="form-group-modern">
                                <label asp-for="CPF" class="form-label-modern">
                                    <i class="fas fa-fingerprint me-1"></i>CPF *
                                </label>
                                <input asp-for="CPF" class="form-control-modern" placeholder="000.000.000-00" maxlength="14" />
                                <span asp-validation-for="CPF" class="text-danger"></span>
                            </div>
                            <div class="form-group-modern">
                                <label asp-for="RG" class="form-label-modern">
                                    <i class="fas fa-id-badge me-1"></i>RG
                                </label>
                                <input asp-for="RG" class="form-control-modern" placeholder="00.000.000-0" />
                                <span asp-validation-for="RG" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group-modern">
                            <label asp-for="DataNascimento" class="form-label-modern">
                                <i class="fas fa-birthday-cake me-1"></i>Data de Nascimento
                            </label>
                            <input asp-for="DataNascimento" class="form-control-modern" type="date" />
                            <span asp-validation-for="DataNascimento" class="text-danger"></span>
                        </div>
                    </div>

                    <!-- Campos Pessoa Jur√≠dica -->
                    <div id="camposPJ" style="display: none;">
                        <div class="form-group-modern">
                            <label asp-for="CNPJ" class="form-label-modern">
                                <i class="fas fa-building me-1"></i>CNPJ *
                            </label>
                            <input asp-for="CNPJ" class="form-control-modern" placeholder="00.000.000/0000-00" maxlength="18" />
                            <span asp-validation-for="CNPJ" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contato -->
            <div class="card-modern">
                <div class="card-header-modern">
                    <i class="fas fa-phone"></i>
                    Informa√ß√µes de Contato
                </div>
                <div class="card-body-modern">
                    <div class="form-group-modern">
                        <label asp-for="Email" class="form-label-modern">
                            <i class="fas fa-envelope me-1"></i>Email
                        </label>
                        <input asp-for="Email" class="form-control-modern" type="email" placeholder="cliente@email.com" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>

                    <div class="grid-2">
                        <div class="form-group-modern">
                            <label asp-for="Telefone" class="form-label-modern">
                                <i class="fas fa-phone me-1"></i>Telefone
                            </label>
                            <input asp-for="Telefone" class="form-control-modern" placeholder="(00) 0000-0000" />
                            <span asp-validation-for="Telefone" class="text-danger"></span>
                        </div>
                        <div class="form-group-modern">
                            <label asp-for="Celular" class="form-label-modern">
                                <i class="fas fa-mobile me-1"></i>Celular
                            </label>
                            <input asp-for="Celular" class="form-control-modern" placeholder="(00) 00000-0000" />
                            <span asp-validation-for="Celular" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Endere√ßo -->
        <div class="card-modern mb-4">
            <div class="card-header-modern">
                <i class="fas fa-map-marker-alt"></i>
                Endere√ßo
            </div>
            <div class="card-body-modern">
                <div class="grid-3">
                    <div class="form-group-modern">
                        <label asp-for="CEP" class="form-label-modern">
                            <i class="fas fa-mail-bulk me-1"></i>CEP
                        </label>
                        <input asp-for="CEP" class="form-control-modern" placeholder="00000-000" maxlength="9" id="cep" />
                        <span asp-validation-for="CEP" class="text-danger"></span>
                    </div>
                    <div class="form-group-modern">
                        <label asp-for="Estado" class="form-label-modern">
                            <i class="fas fa-flag me-1"></i>Estado
                        </label>
                        <select asp-for="Estado" class="form-select-modern" id="estado">
                            <option value="">Selecione...</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amap√°</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Cear√°</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Esp√≠rito Santo</option>
                            <option value="GO">Goi√°s</option>
                            <option value="MA">Maranh√£o</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Par√°</option>
                            <option value="PB">Para√≠ba</option>
                            <option value="PR">Paran√°</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piau√≠</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rond√¥nia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">S√£o Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                        <span asp-validation-for="Estado" class="text-danger"></span>
                    </div>
                    <div class="form-group-modern">
                        <label asp-for="Cidade" class="form-label-modern">
                            <i class="fas fa-city me-1"></i>Cidade
                        </label>
                        <input asp-for="Cidade" class="form-control-modern" placeholder="Nome da cidade" id="cidade" />
                        <span asp-validation-for="Cidade" class="text-danger"></span>
                    </div>
                </div>

                <div class="grid-3">
                    <div class="form-group-modern" style="grid-column: 1 / 3;">
                        <label asp-for="Endereco" class="form-label-modern">
                            <i class="fas fa-road me-1"></i>Endere√ßo
                        </label>
                        <input asp-for="Endereco" class="form-control-modern" placeholder="Rua, avenida..." id="endereco" />
                        <span asp-validation-for="Endereco" class="text-danger"></span>
                    </div>
                    <div class="form-group-modern">
                        <label asp-for="Numero" class="form-label-modern">
                            <i class="fas fa-hashtag me-1"></i>N√∫mero
                        </label>
                        <input asp-for="Numero" class="form-control-modern" placeholder="123" />
                        <span asp-validation-for="Numero" class="text-danger"></span>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="form-group-modern">
                        <label asp-for="Bairro" class="form-label-modern">
                            <i class="fas fa-map me-1"></i>Bairro
                        </label>
                        <input asp-for="Bairro" class="form-control-modern" placeholder="Nome do bairro" id="bairro" />
                        <span asp-validation-for="Bairro" class="text-danger"></span>
                    </div>
                    <div class="form-group-modern">
                        <label asp-for="Complemento" class="form-label-modern">
                            <i class="fas fa-plus me-1"></i>Complemento
                        </label>
                        <input asp-for="Complemento" class="form-control-modern" placeholder="Apto, bloco, etc." />
                        <span asp-validation-for="Complemento" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Observa√ß√µes -->
        <div class="card-modern mb-4">
            <div class="card-header-modern">
                <i class="fas fa-sticky-note"></i>
                Observa√ß√µes Adicionais
            </div>
            <div class="card-body-modern">
                <div class="form-group-modern">
                    <label asp-for="Observacoes" class="form-label-modern">
                        <i class="fas fa-comment me-1"></i>Observa√ß√µes
                    </label>
                    <textarea asp-for="Observacoes" class="form-control-modern" rows="4"
                              placeholder="Informa√ß√µes adicionais sobre o cliente, prefer√™ncias, hist√≥rico..."></textarea>
                    <span asp-validation-for="Observacoes" class="text-danger"></span>
                </div>
            </div>
        </div>

        <!-- Bot√µes -->
        <div class="card-modern">
            <div class="card-body-modern">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        Campos marcados com * s√£o obrigat√≥rios
                    </div>
                    <div class="d-flex gap-3">
                        <button type="button" class="btn-modern btn-secondary-modern" onclick="limparFormulario()">
                            <i class="fas fa-eraser"></i>
                            Limpar
                        </button>
                        <a asp-action="Index" class="btn-modern btn-outline-modern">
                            <i class="fas fa-times"></i>
                            Cancelar
                        </a>
                        <button type="submit" class="btn-modern btn-primary-modern">
                            <i class="fas fa-save"></i>
                            Salvar Cliente
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        // Alternar campos baseado no tipo de cliente
        document.getElementById('tipoCliente').addEventListener('change', function() {
            const tipo = this.value;
            const camposPF = document.getElementById('camposPF');
            const camposPJ = document.getElementById('camposPJ');
            const dadosTitle = document.getElementById('dadosTitle');
            const nomeLabel = document.getElementById('nomeLabel');

            if (tipo === 'PessoaFisica') {
                camposPF.style.display = 'block';
                camposPJ.style.display = 'none';
                dadosTitle.textContent = 'Dados Pessoais';
                nomeLabel.textContent = 'Nome Completo *';
                document.querySelector('input[name="CPF"]').setAttribute('required', 'required');
                document.querySelector('input[name="CNPJ"]').removeAttribute('required');
            } else if (tipo === 'PessoaJuridica') {
                camposPF.style.display = 'none';
                camposPJ.style.display = 'block';
                dadosTitle.textContent = 'Dados Empresariais';
                nomeLabel.textContent = 'Raz√£o Social *';
                document.querySelector('input[name="CNPJ"]').setAttribute('required', 'required');
                document.querySelector('input[name="CPF"]').removeAttribute('required');
            } else {
                camposPF.style.display = 'none';
                camposPJ.style.display = 'none';
                dadosTitle.textContent = 'Dados B√°sicos';
                nomeLabel.textContent = 'Nome *';
                document.querySelector('input[name="CPF"]').removeAttribute('required');
                document.querySelector('input[name="CNPJ"]').removeAttribute('required');
            }
        });

        // Formata√ß√£o de CPF
        document.querySelector('input[name="CPF"]').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            this.value = value;
        });

        // Formata√ß√£o de CNPJ
        document.querySelector('input[name="CNPJ"]').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/^(\d{2})(\d)/, '$1.$2');
            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');
            this.value = value;
        });

        // Formata√ß√£o de CEP
        document.getElementById('cep').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            this.value = value;
        });

        // Buscar CEP
        document.getElementById('cep').addEventListener('blur', function() {
            const cep = this.value.replace(/\D/g, '');
            if (cep.length === 8) {
                buscarCEP(cep);
            }
        });

        async function buscarCEP(cep) {
            try {
                showToast('Buscando CEP...', 'info');
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();

                if (!data.erro) {
                    document.getElementById('endereco').value = data.logradouro;
                    document.getElementById('bairro').value = data.bairro;
                    document.getElementById('cidade').value = data.localidade;
                    document.getElementById('estado').value = data.uf;
                    showToast('CEP encontrado!', 'success');
                } else {
                    showToast('CEP n√£o encontrado!', 'warning');
                }
            } catch (error) {
                showToast('Erro ao buscar CEP!', 'error');
            }
        }

        // Formata√ß√£o de telefones
        document.querySelector('input[name="Telefone"]').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{4})(\d)/, '$1-$2');
            this.value = value;
        });

        document.querySelector('input[name="Celular"]').addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            this.value = value;
        });

        function limparFormulario() {
            if (confirm('Tem certeza que deseja limpar todos os campos?')) {
                document.querySelector('form').reset();
                document.getElementById('camposPF').style.display = 'none';
                document.getElementById('camposPJ').style.display = 'none';
            }
        }
    </script>
}